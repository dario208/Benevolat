<div class="container-fluid" id="emplois">
    <div class="loader my-1" *ngIf="loading$ | async"></div>
    <div class="row mx-md-1">
        <div class="container_texte container px-3">
            <div class="container_input row py-1 px-3 rounded-3 justify-content-center">
                <div class="form-floating col-12 col-md-5 m-2 position-relative">
                    <input type="text" class="form-control rounded-pill ps-4" 
                        id="nom" placeholder="Nom ***" [formControl]="nomSearchCtrl">
                    <label for="nom" class="ms-2">Nom ***</label>
                    <div class="search_icone">
                        <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                    </div>
                </div>
                <div class="form-floating col-12 col-md-5 m-2 position-relative">
                    <input type="text" class="form-control rounded-pill ps-4" 
                        id="categorie" placeholder="Categorie ***" [formControl]="categorieSearchCtrl">
                    <label for="categorie" class="ms-2">Categorie ***</label>
                    <div class="search_icone">
                        <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        <div class="container_cartes my-3">
            <ng-container *ngIf="(emplois$|async)?.length; else empty">
                <div class="row row-cols-1 row-cols-md-4 g-4">
                    <div class="col" *ngFor="let data of emplois$|async">
                        <app-emploi-item [emploi]="data"
                        (displayModal)="listenStatusDisplayerModal($event)"
                        (statusUpdateModal)="listenStatusUpdateModal($event)"
                        (statusDeleteModal)="listenStatusDeleteModal($event)"></app-emploi-item>
                    </div>
                </div>
            </ng-container>
            <ng-template #empty>
                <div class="row mt-3 empty_emplois">
                    <div class="col-12 text-center rounded-3">
                        <img ngSrc="assets/images/emplois.svg" width="411" height="411" priority
                            class="img-fluid">
                    </div>
                </div>
            </ng-template>
        </div>
    </div>
</div>
<div class="p-1" id="add_button" (click)="listenStatusCreateModal()">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
    </svg>
</div>

<!-- ============================== MODAL AJOUTER EMPLOIS ========================= -->
<div class="modal fade" id="modalCreateEmplois" data-bs-backdrop="static" 
    tabindex="-1" aria-labelledby="modalCreateEmploisLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <form class="modal-content" [formGroup]="createForm" (ngSubmit)="onSubmitCreate()">
            <div class="modal-header">
                <h1 class="modal-title fs-5 fw-bold" id="modalCreateEmploisLabel">Ajouter un emploi</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                    (click)="onCloseCreate()"></button>
            </div>
            <div class="modal-body">
                <div class="row my-3 mx-1 px-1 py-3">
                    <!-- =============== NOM =============== -->
                    <div class="col-12">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control ps-4" id="nom_create_emploi" 
                                placeholder="Nom ***" formControlName="nom_emploi">
                            <label for="nom_create_emploi" class="ps-4 d-flex align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M3 2.5a2.5 2.5 0 0 1 5 0 2.5 2.5 0 0 1 5 0v.006c0 .07 0 .27-.038.494H15a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 14.5V7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h2.038A2.968 2.968 0 0 1 3 2.506V2.5zm1.068.5H7v-.5a1.5 1.5 0 1 0-3 0c0 .085.002.274.045.43a.522.522 0 0 0 .023.07zM9 3h2.932a.56.56 0 0 0 .023-.07c.043-.156.045-.345.045-.43a1.5 1.5 0 0 0-3 0V3zM1 4v2h6V4H1zm8 0v2h6V4H9zm5 3H9v8h4.5a.5.5 0 0 0 .5-.5V7zm-7 8V7H2v7.5a.5.5 0 0 0 .5.5H7z"/>
                                </svg>
                                <span class="mx-3">Nom:</span>
                            </label>
                        </div>
                    </div>

                    <!-- ================= DESCRIPTION ================ -->
                    <div class="col-12">
                        <div class="form-floating">
                            <textarea class="form-control ps-4" id="description_create_emploi" 
                                placeholder="Description ***" formControlName="description"></textarea>
                            <label for="description_create_emploi" class="ps-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M2.5 3a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1h-11zm0 3a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1h-6zm0 3a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1h-6zm0 3a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1h-11zm10.113-5.373a6.59 6.59 0 0 0-.445-.275l.21-.352c.122.074.272.17.452.287.18.117.35.26.51.428.156.164.289.351.398.562.11.207.164.438.164.692 0 .36-.072.65-.216.873-.145.219-.385.328-.721.328-.215 0-.383-.07-.504-.211a.697.697 0 0 1-.188-.463c0-.23.07-.404.211-.521.137-.121.326-.182.569-.182h.281a1.686 1.686 0 0 0-.123-.498 1.379 1.379 0 0 0-.252-.37 1.94 1.94 0 0 0-.346-.298zm-2.168 0A6.59 6.59 0 0 0 10 6.352L10.21 6c.122.074.272.17.452.287.18.117.35.26.51.428.156.164.289.351.398.562.11.207.164.438.164.692 0 .36-.072.65-.216.873-.145.219-.385.328-.721.328-.215 0-.383-.07-.504-.211a.697.697 0 0 1-.188-.463c0-.23.07-.404.211-.521.137-.121.327-.182.569-.182h.281a1.749 1.749 0 0 0-.117-.492 1.402 1.402 0 0 0-.258-.375 1.94 1.94 0 0 0-.346-.3z"/>
                                </svg>
                                <span class="mx-2">Description:</span>
                            </label>
                        </div>
                    </div>

                     <!-- ================= CATEGORIE ================= -->
                     <div class="col-12 mb-2 mt-3 container_checkbox">
                        <div class="">
                            <span class="mx-3 fw-bold">Categorie d'emplois:</span>
                        </div>
                        <ul class="list-group my-2" *ngIf="categorie$ | async as categorie">
                            <li class="list-group-item" *ngFor="let data of categorie">
                              <input class="form-check-input me-1" type="checkbox" [value]="data.id" 
                              [id]="data.id + 'cc1'"
                                formArray="categorieCreateArray"
                                (change)="onChangeCategorieCreate($event)">
                              <label class="form-check-label stretched-link ms-2" 
                                [for]="data.id + 'cc1'">{{data.categorie | titlecase}}</label>
                            </li>
                        </ul>
                    </div>

                    <!-- ================== DOMAINE =================== -->
                    <div class="col-12 my-2 container_checkbox">
                        <div class="">
                            <span class="mx-3 fw-bold">Domaine de competences:</span>
                        </div>
                        <ul class="list-group my-2" *ngIf="domaine$ | async as domaine">
                            <li class="list-group-item" *ngFor="let data of domaine">
                              <input class="form-check-input me-1" type="checkbox" [value]="data.id" 
                                [id]="data.id + 'dc1'"
                                formArray="domaineCreateArray"
                                (change)="onChangeDomaineCreate($event)">
                              <label class="form-check-label stretched-link ms-2" 
                                [for]="data.id + 'dc1'">{{data.nom | titlecase}}</label>
                            </li>
                        </ul>
                    </div>

                    <!-- =================== STATUS ===================== -->
                    <div class="col-12 my-2 container_checkbox">
                        <div class="">
                            <span class="mx-3 fw-bold">Status professionnels:</span>
                        </div>
                        <ul class="list-group my-2" *ngIf="status$ | async as status">
                            <li class="list-group-item" *ngFor="let data of status">
                              <input class="form-check-input me-1" type="checkbox" [value]="data.id" 
                                [id]="data.id + 'sc1'"
                                formArray="statusCreateArray"
                                (change)="onChangeStatusCreate($event)">
                              <label class="form-check-label stretched-link ms-2" 
                                [for]="data.id + 'sc1'">{{data.status | titlecase}}</label>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close" 
                    data-bs-dismiss="modal" (click)="onCloseCreate()">Annuler</button>
                <button type="submit" class="btn rounded-pill valider fw-bold" 
                    [disabled]="createForm.invalid">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- ============================== MODAL MODIFIER EMPLOIS ========================= -->
<div class="modal fade" id="modalModifierEmplois" data-bs-backdrop="static" 
    tabindex="-1" aria-labelledby="modalModifierEmploisLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <form class="modal-content" [formGroup]="updateForm" (ngSubmit)="onSubmitUpdate()">
            <div class="modal-header">
                <h1 class="modal-title fs-5 fw-bold" id="modalModifierEmploisLabel">Modifier un emploi</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                    (click)="onCloseUpdate()"></button>
            </div>
            <div class="modal-body">
                <div class="row my-3 mx-1 px-1 py-3">
                    <!-- =============== NOM =============== -->
                    <div class="col-12">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control ps-4" id="nom_update_emploi" 
                                placeholder="Nom ***" formControlName="nom_emploi">
                            <label for="nom_update_emploi" class="ps-4 d-flex align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M3 2.5a2.5 2.5 0 0 1 5 0 2.5 2.5 0 0 1 5 0v.006c0 .07 0 .27-.038.494H15a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 14.5V7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h2.038A2.968 2.968 0 0 1 3 2.506V2.5zm1.068.5H7v-.5a1.5 1.5 0 1 0-3 0c0 .085.002.274.045.43a.522.522 0 0 0 .023.07zM9 3h2.932a.56.56 0 0 0 .023-.07c.043-.156.045-.345.045-.43a1.5 1.5 0 0 0-3 0V3zM1 4v2h6V4H1zm8 0v2h6V4H9zm5 3H9v8h4.5a.5.5 0 0 0 .5-.5V7zm-7 8V7H2v7.5a.5.5 0 0 0 .5.5H7z"/>
                                </svg>
                                <span class="mx-3">Nom:</span>
                            </label>
                        </div>
                    </div>

                    <!-- ================= DESCRIPTION ================ -->
                    <div class="col-12">
                        <div class="form-floating">
                            <textarea class="form-control ps-4" id="description_update_emploi" 
                                placeholder="Description ***" formControlName="description"></textarea>
                            <label for="description_update_emploi" class="ps-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M2.5 3a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1h-11zm0 3a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1h-6zm0 3a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1h-6zm0 3a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1h-11zm10.113-5.373a6.59 6.59 0 0 0-.445-.275l.21-.352c.122.074.272.17.452.287.18.117.35.26.51.428.156.164.289.351.398.562.11.207.164.438.164.692 0 .36-.072.65-.216.873-.145.219-.385.328-.721.328-.215 0-.383-.07-.504-.211a.697.697 0 0 1-.188-.463c0-.23.07-.404.211-.521.137-.121.326-.182.569-.182h.281a1.686 1.686 0 0 0-.123-.498 1.379 1.379 0 0 0-.252-.37 1.94 1.94 0 0 0-.346-.298zm-2.168 0A6.59 6.59 0 0 0 10 6.352L10.21 6c.122.074.272.17.452.287.18.117.35.26.51.428.156.164.289.351.398.562.11.207.164.438.164.692 0 .36-.072.65-.216.873-.145.219-.385.328-.721.328-.215 0-.383-.07-.504-.211a.697.697 0 0 1-.188-.463c0-.23.07-.404.211-.521.137-.121.327-.182.569-.182h.281a1.749 1.749 0 0 0-.117-.492 1.402 1.402 0 0 0-.258-.375 1.94 1.94 0 0 0-.346-.3z"/>
                                </svg>
                                <span class="mx-2">Description:</span>
                            </label>
                        </div>
                    </div>

                     <!-- ================= CATEGORIE ================= -->
                     <div class="col-12 mb-2 mt-3 container_checkbox">
                        <div class="">
                            <span class="mx-3 fw-bold">Categorie d'emplois:</span>
                        </div>
                        <ul class="list-group my-2" *ngIf="categorie$ | async as categorie">
                            <li class="list-group-item" *ngFor="let data of categorie">
                              <input class="form-check-input me-1" type="checkbox" [value]="data.id" 
                                [id]="data.id + 'cu1'"
                                formArray="categorieUpdateArray"
                                (change)="onChangeCategorieUpdate($event)">
                              <label class="form-check-label stretched-link ms-2" 
                                [for]="data.id + 'cu1'">{{data.categorie | titlecase}}</label>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close" 
                    data-bs-dismiss="modal" (click)="onCloseUpdate()">Annuler</button>
                <button type="submit" class="btn rounded-pill valider fw-bold" 
                    [disabled]="updateForm.invalid">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- ============================== MODAL SUPPRIMER EMPLOIS ========================= -->
<div class="modal fade" id="modalSupprimerEmplois" data-bs-backdrop="static" 
    tabindex="-1" aria-labelledby="modalSupprimerEmploisLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-6 fw-bold" id="modalSupprimerEmploisLabel">Suppression</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                    (click)="onCloseDelete()"></button>
            </div>
            <div class="modal-body d-flex align-items-center justify-content-center text-danger">
                <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" 
                    class="w-25" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                </svg>
                <div class="ms-2">
                    Voulez-vous supprimer <span class="fw-bold">{{currentEmploi?.nom_emploi}} ?</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn text-muted close" 
                    data-bs-dismiss="modal" (click)="onCloseDelete()">Non</button>
                <button type="button" class="btn text-danger valider fw-bold" 
                    (click)="onConfirmDelete()">Oui</button>
            </div>
        </div>
    </div>
</div>

<!-- ============================== MODAL DISPLAY EMPLOIS ========================= -->
<div class="modal fade" id="modalDisplayEmplois" data-bs-backdrop="static" 
    tabindex="-1" aria-labelledby="modalDisplayEmploisLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-6 fw-bold" id="modalDisplayEmploisLabel">{{currentEmploi?.nom_emploi}}</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                    (click)="oncloseDisplay()"></button>
            </div>
            <div class="modal-body">
                <div class="entete">
                    <span class="fw-bold nom">
                        <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                            <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                            <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                        </svg>
                        {{currentEmploi?.nom_admin}}
                    </span>
                    <span class="ms-4 date">{{currentEmploi?.created_at | date: 'dd MMMM  y, HH:mm:ss'}}</span>
                </div>
                <div class="rounded-3 mt-3 py-2 px-3 description_emploi">
                    <span [innerHTML]="currentEmploi?.description"></span>
                </div>
                <div class="categorie_emploi mt-3 text-end">
                    <span class="titre fw-bold">Categorie d'emplois:</span>
                    {{currentEmploi?.categorie_emplois | titlecase}}
                </div>
            </div>
        </div>
    </div>
</div>
